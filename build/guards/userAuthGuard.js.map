{"version":3,"file":"userAuthGuard.js","names":["verify","require","userAuthGuard","req","res","next","authorization","headers","status","json","msg","token","split","payload","process","env","JWT_SECRET_KEY","usuario","error","console","log","exports"],"sources":["../../src/guards/userAuthGuard.js"],"sourcesContent":["const { verify } = require('jsonwebtoken');\n\n// Creates a Guard to dennegate/authorize the user\nfunction userAuthGuard(req, res, next) {\n  // Captures Authorization header\n  const { authorization } = req.headers;\n  // Checks if it has the Authorization header\n  if (!authorization) {\n    // Return error 403, if header wasn't sent\n    next(res.status(403).json({ status: 'error', msg: 'NO autorizado' }));\n  }\n  try {\n    // Grabs the token from the Authorization header.\n    const token = authorization.split(' ')[1];\n    // Takes the payload from the token\n    const payload = verify(token, process.env.JWT_SECRET_KEY);\n    // Verifies the role of the user, admitting only admins.\n    if (!payload.usuario) {\n      next(res.status(403).json({ status: 'error', msg: 'NO autorizado' }));\n    }\n  } catch (error) {\n    console.log(error);\n    next(res.status(500).json({ status: 'error', msg: 'NO autorizado' }));\n  }\n  // Pasa a ejecutar la API\n  next();\n}\n\nexports.userAuthGuard = userAuthGuard;\n"],"mappings":";;AAAA,MAAM;EAAEA;AAAO,CAAC,GAAGC,OAAO,CAAC,cAAc,CAAC;;AAE1C;AACA,SAASC,aAAa,CAACC,GAAG,EAAEC,GAAG,EAAEC,IAAI,EAAE;EACrC;EACA,MAAM;IAAEC;EAAc,CAAC,GAAGH,GAAG,CAACI,OAAO;EACrC;EACA,IAAI,CAACD,aAAa,EAAE;IAClB;IACAD,IAAI,CAACD,GAAG,CAACI,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;MAAED,MAAM,EAAE,OAAO;MAAEE,GAAG,EAAE;IAAgB,CAAC,CAAC,CAAC;EACvE;EACA,IAAI;IACF;IACA,MAAMC,KAAK,GAAGL,aAAa,CAACM,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;IACzC;IACA,MAAMC,OAAO,GAAGb,MAAM,CAACW,KAAK,EAAEG,OAAO,CAACC,GAAG,CAACC,cAAc,CAAC;IACzD;IACA,IAAI,CAACH,OAAO,CAACI,OAAO,EAAE;MACpBZ,IAAI,CAACD,GAAG,CAACI,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;QAAED,MAAM,EAAE,OAAO;QAAEE,GAAG,EAAE;MAAgB,CAAC,CAAC,CAAC;IACvE;EACF,CAAC,CAAC,OAAOQ,KAAK,EAAE;IACdC,OAAO,CAACC,GAAG,CAACF,KAAK,CAAC;IAClBb,IAAI,CAACD,GAAG,CAACI,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;MAAED,MAAM,EAAE,OAAO;MAAEE,GAAG,EAAE;IAAgB,CAAC,CAAC,CAAC;EACvE;EACA;EACAL,IAAI,EAAE;AACR;AAEAgB,OAAO,CAACnB,aAAa,GAAGA,aAAa"}